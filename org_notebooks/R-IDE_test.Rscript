library("plyr")
library("dplyr")
library("IDE")
library("FRK")
library("ggplot2")
library("sp")
library("spacetime")
library("STRbook")

SIM1 <- simIDE(T = 10, nobs = 100, k_spat_invariant = 1)

print(SIM1$g_truth)
print(SIM1$g_obs)

IDEmodel <- IDE(f = z ~ s1 + s2,
         data = SIM1$z_STIDF,
         dt = as.difftime(1, units = "days"),
         grid_size = 41)

start_time <- Sys.time()

fit_results_sim1 <- fit.IDE(IDEmodel,
                 parallelType = 1)

end_time <- Sys.time()
elapsed_time <- end_time - start_time
print(elapsed_time)

show_kernel(fit_results_sim1$IDEmodel)
fit_results_sim1$IDEmodel$get("k") %>% unlist()
coef(fit_results_sim1$IDEmodel)

# Time difference of 18.88936 mins
# Kernel is spatially invariant, plotting it centred on the origin.         par1          par2          par3          par4 
# 152.836345912   0.001977115  -0.101601099   0.100368743 
# Intercept        s1        s2 
# 0.2073442 0.1966224 0.1907062 
